"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[9630],{8453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>s});var i=t(6540);const a={},r=i.createContext(a);function l(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),i.createElement(r.Provider,{value:n},e.children)}},9189:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>g,contentTitle:()=>h,default:()=>u,frontMatter:()=>d,metadata:()=>i,toc:()=>p});const i=JSON.parse('{"id":"tasks/efficienttrain/paged attention","title":"Paged Attention","description":"Efficient Memory Management for Large Language Model Serving with Paged Attention","source":"@site/docs/tasks/efficienttrain/pagedattention.md","sourceDirName":"tasks/efficienttrain","slug":"/tasks/efficienttrain/paged attention","permalink":"/docs/tasks/efficienttrain/paged attention","draft":false,"unlisted":false,"editUrl":"https://github.com/logicbaron/logicbaron.github.io/tree/dev/docs/tasks/efficienttrain/pagedattention.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"id":"paged attention","sidebar_position":3},"sidebar":"EfficienttrainSidebar","previous":{"title":"ZERO INFINITY","permalink":"/docs/tasks/efficienttrain/zero_infinity"},"next":{"title":"Sparsely-Gated MOE Layer","permalink":"/docs/tasks/efficienttrain/MOE/moe1"}}');var a=t(4848),r=t(8453);const l=t.p+"assets/images/pagedattention_motivation-e29a19ae78d7837158725235d94393d3.png",s=t.p+"assets/images/pagedattention_multiplerequest-844ece34126f77c58fff3d3e48c26e20.png",o=t.p+"assets/images/pagedattetion_parallelsampling-21556a31f6223932d34fe9fe33219d62.png",c=t.p+"assets/images/pagedattention_beamsearch-ae4e0847d7042a9f20443f58e620299d.png",d={id:"paged attention",sidebar_position:3},h="Paged Attention",g={},p=[{value:"Efficient Memory Management for Large Language Model Serving with Paged Attention",id:"efficient-memory-management-for-large-language-model-serving-with-paged-attention",level:2},{value:"Motivation",id:"motivation",level:2},{value:"Solution",id:"solution",level:2},{value:"Decoding",id:"decoding",level:2},{value:"1. multiple requests",id:"1-multiple-requests",level:4},{value:"2. Parallel Sampling",id:"2-parallel-sampling",level:3},{value:"3. Beam Search",id:"3-beam-search",level:3},{value:"Conclusion",id:"conclusion",level:2},{value:"Ref",id:"ref",level:2}];function m(e){const n={a:"a",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"paged-attention",children:"Paged Attention"})}),"\n",(0,a.jsx)(n.h2,{id:"efficient-memory-management-for-large-language-model-serving-with-paged-attention",children:"Efficient Memory Management for Large Language Model Serving with Paged Attention"}),"\n",(0,a.jsx)(n.p,{children:"\uc694\uc998 \uc774\ub798\uc800\ub798 \uc2dc\uac04\uc774 \ubd80\uc871\ud574\uc11c \ub17c\ubb38 \ub0b4\uc6a9\uc744 \uc0c1\uc138\ud558\uac8c \uc815\ub9ac\ud558\uae30 \uc5b4\ub835\ub2e4. \uc815\ub9d0 \uc911\uc694\ud55c \ub17c\ubb38\uc774 \uc544\ub2c8\uba74 \uae4a\uac8c \uc77d\uc9c0 \ubabb\ud558\uae30\ub3c4 \ud558\uace0. \uc544\uc27d\uc9c0\ub9cc \ud0c0\ud611\ud574\uc57c\ud560\uac83 \uac19\ub2e4. \uc778\uc9c0\ud55c \ud575\uc2ec \ub0b4\uc6a9 \uc704\uc8fc\ub85c\ub9cc \uc815\ub9ac\ud558\ub824 \ud55c\ub2e4."}),"\n",(0,a.jsx)(n.p,{children:"\uae00\uc744 \uc4f0\ub294 \uc2dc\uc810\uc5d0\uc11c\ub294 \uaf64 \uc624\ub798\ub418\uc5c8\uae30\ub3c4\ud558\uace0 \ub300\uc911\ud654\ub41c solution \uc774\uba70, \ub300\ubd80\ubd84 \ud070 \uace8\uc790\uc758 \ub0b4\uc6a9\uc740 \uc778\uc9c0\ud558\uace0 \uc788\uc744 \uac83 \uac19\ub2e4."}),"\n",(0,a.jsx)(n.p,{children:"Paged Attention \uc740 vLLM \ub77c\uc774\ube0c\ub7ec\ub9ac\uc758 \ud575\uc2ec \uae30\uc220\uc774\ub2e4. vLLM \uc740 dynamic batching \uacfc \uac19\uc740 \ub2e4\uc591\ud55c \uc194\ub8e8\uc158\uc744 \uc81c\uacf5\ud558\uc9c0\ub9cc, Paged Attention \uc744 \uc774\uc6a9\ud55c KV cache \ud6a8\uc728\ud654\uac00 \uac00\uc7a5 \uc911\uc694\ud558\ub2e4."}),"\n",(0,a.jsx)(n.h2,{id:"motivation",children:"Motivation"}),"\n",(0,a.jsx)(n.p,{children:"\uc800\uc790\ub4e4\uc740 LLM inference, \uadf8\ub9ac\uace0 \uc774\uc804 \ud6a8\uc728\ud654 \uc194\ub8e8\uc158\uc758 \ubb38\uc81c\uc810\uc744 \uc544\ub798\uc640 \uac19\uc774 \uc9c0\uc801\ud55c\ub2e4."}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"\ud604\ub300 LLM \uc774 \ucc28\uc6a9\ud558\ub294 autoregressive \uad6c\uc870, \uc989 sequential generation \uacfc\uc815\uc5d0\uc11c\ub294 memory \ud55c\uacc4\uc5d0 \uba3c\uc800 \ubd80\ub52a\ud788\uac8c \ub41c\ub2e4. \uc774\ub85c \uc778\ud574 GPU utilization \uc774 \ub5a8\uc5b4\uc9c0\uac8c \ub41c\ub2e4.\n1-1. \uc608\ub97c \ub4e4\uc5b4\uc11c, \uba54\ubaa8\ub9ac \ud55c\uacc4\ub294 LLM \uc11c\ube59 \uc2dc\uc2a4\ud15c\uc5d0\uc11c \ubc30\uce58 \uc0ac\uc774\uc988\ub97c \uacb0\uc815\ud558\ub294 \uac00\uc7a5 \uc911\uc694\ud55c \uc694\uc778 \uc911 \ud558\ub098\uc774\ub2e4."}),"\n",(0,a.jsx)(n.li,{children:"\ud604\ub300 tensor \ub77c\uc774\ube0c\ub7ec\ub9ac\ub4e4\uc740 tensor \ub97c \uc5f0\uc18d\ub41c \uba54\ubaa8\ub9ac \uacf5\uac04 (contiguous memory space) \uc5d0 \uc800\uc7a5\ud55c\ub2e4."}),"\n",(0,a.jsx)(n.li,{children:"\uc77c\ubc18\uc801\uc778 LLM \uc11c\ube59 \uc2dc\uc2a4\ud15c\uc740 \uc774\ub85c\uc778\ud574 KV cache \uc5ed\uc2dc \uc5f0\uc18d\ub41c \uba54\ubaa8\ub9ac \uacf5\uac04\uc5d0 \ud560\ub2f9\ud55c\ub2e4."}),"\n",(0,a.jsx)(n.li,{children:"\uadf8\ub7f0\ub370 KV cache \ub294 \ub514\ucf54\ub529 \ubc29\uc2dd, \ub2e4\uc591\ud55c prompt \ud65c\uc6a9\uc5d0 \ub530\ub77c\uc11c \uacc4\uc18d \ub2ec\ub77c\uc9c0\uace0 \uc774\ub85c \uc778\ud574 contigous memory \ub97c \ubbf8\ub9ac \ud560\ub2f9\ud558\uae30 \uc5b4\ub835\ub2e4. chunk \ubc29\uc2dd\uc744 \uc0ac\uc6a9\ud558\ub294 \uc194\ub8e8\uc158\uc774 \uc720\uba85\ud558\ub098 \uc774 \ubc29\uc2dd\uc740 KV cache \uc758 \ud06c\uae30\uac00 \ucee4\uc9c8\ub584\ub9c8\ub2e4 chunk \ud574\uc81c -> chunk \uc7ac\ud560\ub2f9 -> KV cache \uc62c\ub9ac\uae30\uc758 \uacfc\uc815\uc744 \uac70\uccd0\uc57c\ud558\ubbc0\ub85c \uc18d\ub3c4\ub97c \uc800\ud574\ud558\ub294 \ud070 \uc694\uc778\uc774 \ub41c\ub2e4."}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"solution",children:"Solution"}),"\n",(0,a.jsx)(n.p,{children:"Paged Attention \uc740 \uc774 \ub54c\ubb38\uc5d0 \ub2e4\uc74c\uacfc \uac19\uc740 \uc194\ub8e8\uc158\uc744 \uc81c\uc548\ud55c\ub2e4."}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"KV cache \ub97c \ucabc\uac20\ub2e4. \ud1a0\ud070 \ub2e8\uc704\ub85c KV cache \ub97c \uba54\ubaa8\ub9ac\uc5d0 \ud560\ub2f9\ud558\uace0 \uc774\ub97c \ubd88\ub7ec\uc640\uc11c \uc0ac\uc6a9\ud55c\ub2e4."}),"\n",(0,a.jsx)(n.li,{children:"\uc815\ud655\ud788\ub294 \uba54\ubaa8\ub9ac \ube14\ub85d\uc744 \uc0ac\uc6a9\ud55c\ub2e4. \uba54\ubaa8\ub9ac \ube14\ub85d\uc740 N \uac1c\uc758 \ud1a0\ud070 KV cache \ub97c \uc800\uc7a5\ud55c\ub2e4. \ube14\ub85d\uc774 \ub2e4 \ucc28\uba74 \uc0c8\ub85c\uc6b4 \ube14\ub85d\uc744 \ud560\ub2f9\ud55c\ub2e4."}),"\n",(0,a.jsx)(n.li,{children:"\uac01 \ube14\ub85d\uc740 reference count \ub97c \uac00\uc9c4\ub2e4. \ud574\ub2f9 \ube14\ub85d\uc758 \ucc38\uc870 \uc218\ub97c \uc800\uc7a5\ud55c\ub2e4."}),"\n",(0,a.jsx)(n.li,{children:"reference count \uac00 0 \uc774\ub41c KV block \uc740 \uba54\ubaa8\ub9ac \ud574\uc81c\ud55c\ub2e4."}),"\n"]}),"\n",(0,a.jsx)("div",{style:{textAlign:"Center"},children:(0,a.jsx)("img",{src:l,style:{border:"solid","wi\u3148dth":600}})}),"\n",(0,a.jsx)(n.p,{children:"KV cache \ubc29\uc2dd\uc73c\ub85c \uc778\ud574 chunk \ub0b4\uc5d0\uc11c \ubd88\ud544\uc694\ud55c \uba54\ubaa8\ub9ac \ud65c\uc6a9\uc774 \uc904\uc5b4\ub4e0\ub2e4. \ud1a0\ud070 \ub2e8\uc704\ub85c \uba54\ubaa8\ub9ac\ub97c \ucd5c\ub300\ud55c \ucc44\uc6b0\ubbc0\ub85c inference \uacfc\uc815\uc5d0\uc11c \ube48 block \uc774 \ub9ce\uc544\uc9c8 \uc5fc\ub824\uac00 \uc801\ub2e4. \ub610\ud55c, \ubcf4\ub2e4 \uc791\uc740 \ub2e8\uc704\ub85c block \uc744 \ub098\ub204\uc5b4\uc11c \uc0ac\uc6a9\ud568\uc73c\ub85c\uc368 inference \uacfc\uc815\uc5d0\uc11c \uba54\ubaa8\ub9ac\uc758 \uc77c\ubd80\ub9cc \ub85c\ub4dc\ud574\uc11c \uc0ac\uc6a9\ud574\uc57c\ud558\ub294 fragmentation \ubc1c\uc0dd\ub3c4 \uc801\ub2e4."}),"\n",(0,a.jsx)(n.p,{children:"\uc704 \uadf8\ub9bc\uc740 \ubc30\uce58 \uc0ac\uc774\uc988\ub97c \ub298\ub824\uac10\uc5d0 \ub530\ub77c paged attention \uc774 \uc5bc\ub9c8\ub098 \ud6a8\uc728\uc801\uc73c\ub85c \uba54\ubaa8\ub9ac\ub97c \uc0ac\uc6a9\ud558\ub294\uc9c0 \ubcf4\uc5ec\uc900\ub2e4."}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\ucc38\uace0\ub85c \ub17c\ubb38\uc5d0\uc11c\ub294 different head, different layer \uc758 key \uc640 value vector \ub97c \uc804\ubd80 \ub530\ub85c \uc800\uc7a5\ud55c\ub2e4\uace0 \uc124\uba85\ud55c\ub2e4."}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"decoding",children:"Decoding"}),"\n",(0,a.jsx)(n.p,{children:"vllm \uc740 \uc11c\ube59 \ud504\ub808\uc784\uc6cc\ud06c\ub85c \uc2e4\uc81c inference \uc2dc \ub3d9\uc791\uc774 \uc911\uc694\ud558\ub2e4."}),"\n",(0,a.jsx)(n.h4,{id:"1-multiple-requests",children:"1. multiple requests"}),"\n",(0,a.jsx)("div",{style:{textAlign:"Center"},children:(0,a.jsx)("img",{src:s,style:{border:"solid",width:600}})}),"\n",(0,a.jsx)(n.h3,{id:"2-parallel-sampling",children:"2. Parallel Sampling"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"prompt \ub294 multiple generation \uc5d0\uc11c \ucd5c\ub300\ud55c \ub3d9\uc2dc\uc5d0 \uacf5\uc720"}),"\ud55c\ub2e4. \uadf8\ub7ec\ub098 Paged Attention \uc124\uacc4\uc0c1 \ucc44\uc6b8 \uc218 \uc788\ub294 \ube14\ub85d\uc744 \ucc44\uc6b0\ub294\ub370, \uc774\ub85c \uc778\ud574 prompt \uc758 \ub9c8\uc9c0\ub9c9 block \uc774 generated token \uc744 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub2e4. \uadf8\ub9bc \ucc38\uc870."]}),"\n",(0,a.jsx)(n.p,{children:"\uadf8\ub7ec\ubbc0\ub85c prompt \uc758 \ub9c8\uc9c0\ub9c9 \ud1a0\ud070\uc73c\ub85c KV block \uc774 \uaf49 \ucc28\uc9c0 \uc54a\uc558\uc744 \uacbd\uc6b0, parallel genration \ub9c8\ub2e4 \ube14\ub85d\uc744 copy-on-write \ub97c \uc9c4\ud589\ud55c\ub2e4."}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"generation token \ub4e4\uc740 \uac01\uac01\uc774 KV block \uc744 \ub3c5\ub9bd\uc801\uc73c\ub85c \uc0ac\uc6a9"}),"\ud55c\ub2e4."]}),"\n",(0,a.jsx)("div",{style:{textAlign:"Center"},children:(0,a.jsx)("img",{src:o,style:{border:"solid",width:600}})}),"\n",(0,a.jsx)(n.h3,{id:"3-beam-search",children:"3. Beam Search"}),"\n",(0,a.jsx)(n.p,{children:"\ucd5c\uadfc \ud504\ub85c\uc81d\ud2b8\uc5d0\uc11c vllm beam search \ub97c \uace0\ub824\ud574\uc57c\ud588\ub2e4. vllm \uc5d0\uc11c\ub3c4 \uaf64 \uc624\ub7ab\ub3d9\uc548 beam search \ub294 \uc5f4\uc5b4\uc8fc\uc9c0 \uc54a\uc558\ub294\ub370 \uc774\ub860 \uc0c1\uc758 \uad6c\ud604\ubcf4\ub2e4 \uc5d4\uc9c0\ub2c8\uc5b4\ub9c1\uc774 \uc0c1\ub2f9\ud788 \uc5b4\ub824\uc6b4 \uac83 \uac19\uc558\ub2e4."}),"\n",(0,a.jsx)("div",{style:{textAlign:"Center"},children:(0,a.jsx)("img",{src:c,style:{border:"solid",width:800}})}),"\n",(0,a.jsx)(n.p,{children:"beam search \ub294 \uae30\ubcf8\uc801\uc73c\ub85c \ubd84\uae30\uac00 \ub098\ub258\uc5b4\uc9c0\ub294 \ud615\ud0dc\ub97c \uac00\uc9c0\uac8c \ub418\ubbc0\ub85c, reference count \uac00 \uc801\uadf9\uc801\uc73c\ub85c \ud65c\uc6a9\ub41c\ub2e4. \uacf5\uc720\ud560 \uc218 \uc788\ub294 \uc774\uc804 block \uc740 \ucd5c\ub300\ud55c \uacf5\uc720\ud558\uba74\uc11c KV cache \ub97c \uc0ac\uc6a9\ud558\ub2e4 reference count \uac00 0 \uc774 \ub418\ub294 \ube14\ub85d\uc744 \ud574\uc81c\ud55c\ub2e4. \uc989 beam \uc774 \ud0c8\ub77d\ud558\uba74 KV block \uba54\ubaa8\ub9ac\ub3c4 \ud574\uc81c\ub41c\ub2e4."}),"\n",(0,a.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,a.jsx)(n.p,{children:"\uac1c\uc778\uc801 \uacac\ud574\ub85c, \ubaa8\ub4e0 \uc11c\ube59 \uc2dc\uc2a4\ud15c\uc774 \uadf8\ub807\uc9c0\ub9cc \uc5d4\uc9c0\ub2c8\uc5b4\ub9c1\uc758 \uc608\uc220 \uac19\ub2e4. \uc774\ub860\uc744 \ud6a8\uc728\uc801\uc73c\ub85c \uad6c\ud604\ud558\ub294 \uac83."}),"\n",(0,a.jsx)(n.p,{children:"\ub610 \uc77d\uc73c\uba74\uc11c \uc57d\uac04 \ub354 \ucee4\ub110 \ub808\ubca8.. \ud558\ub4dc\uc6e8\uc5b4 \ub808\ubca8\uc758 \uacf5\ubd80\ub97c \uc870\uae08\uc529\uc774\ub77c\ub3c4 \ud574\ub454 \uac83\ub4e4\uc774 \ub3c4\uc6c0\uc774 \ub418\ub294 \uac83 \uac19\ub2e4."}),"\n",(0,a.jsx)(n.h2,{id:"ref",children:"Ref"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://arxiv.org/pdf/2309.06180",children:"https://arxiv.org/pdf/2309.06180"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(m,{...e})}):m(e)}}}]);