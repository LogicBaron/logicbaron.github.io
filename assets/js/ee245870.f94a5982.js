"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[2257],{42:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/image-3-7a62c6d7332782a6f73625d980c345d9.png"},803:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/image-2-dc7062c64d10d8865afb9a56ccb3a5b8.png"},4709:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/image-4-7173f35f7f8f5724052e303e1754f0a8.png"},6312:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/image-1-3dc0bd60cc01789f5ad604cdf1209444.png"},7098:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>o,frontMatter:()=>a,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"tasks/efficienttrain/MOE/switchformer","title":"Switch Transformers","description":"Introduction","source":"@site/docs/tasks/efficienttrain/MOE/switchformer.md","sourceDirName":"tasks/efficienttrain/MOE","slug":"/tasks/efficienttrain/MOE/switchformer","permalink":"/docs/tasks/efficienttrain/MOE/switchformer","draft":false,"unlisted":false,"editUrl":"https://github.com/logicbaron/logicbaron.github.io/tree/dev/docs/tasks/efficienttrain/MOE/switchformer.md","tags":[{"inline":true,"label":"MOE","permalink":"/docs/tags/moe"},{"inline":true,"label":"Transformer","permalink":"/docs/tags/transformer"}],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Switch Transformers","sidebar_position":3,"tags":["MOE","Transformer"]},"sidebar":"EfficienttrainSidebar","previous":{"title":"GShard","permalink":"/docs/tasks/efficienttrain/MOE/gshard"},"next":{"title":"Efficient MOE","permalink":"/docs/tasks/efficienttrain/MOE/moe3"}}');var t=s(4848),r=s(8453);const a={title:"Switch Transformers",sidebar_position:3,tags:["MOE","Transformer"]},l="Switch Transformer",c={},d=[{value:"Introduction",id:"introduction",level:2},{value:"Model \uad6c\uc870",id:"model-\uad6c\uc870",level:2},{value:"Attention Layer Expert",id:"attention-layer-expert",level:3},{value:"Single Expert",id:"single-expert",level:3},{value:"Differentiable Load Balancing",id:"differentiable-load-balancing",level:3},{value:"Result",id:"result",level:2},{value:"Scaling Result",id:"scaling-result",level:3},{value:"Fine-tuning",id:"fine-tuning",level:3},{value:"Distillation",id:"distillation",level:3}];function h(e){const n={a:"a",annotation:"annotation",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",math:"math",mi:"mi",mn:"mn",mo:"mo",mrow:"mrow",msub:"msub",ol:"ol",p:"p",semantics:"semantics",span:"span",strong:"strong",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"switch-transformer",children:"Switch Transformer"})}),"\n",(0,t.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,t.jsx)(n.p,{children:"Transformer \uacc4\uc5f4 \ub17c\ubb38\uc5d0 MOE\ub97c \uc801\uc6a9\ud55c \ub450 \ubc88\uc9f8 \ub300\ud45c\uc801\uc778 \ub17c\ubb38. GShard \uc774\ud6c4\ub85c\ub3c4 Transformer \uad00\ub828 \uc5f0\uad6c\uc758 \uc8fc\ub958\ub294 MOE \ub97c \uc774\uc6a9\ud55c \ubaa8\ub378\uc758 \ud655\uc7a5\ubcf4\ub2e4\ub294 dense \ubaa8\ub378\uc758 \ud655\uc7a5, \uc751\uc6a9\uc774\uc5c8\uc2b5\ub2c8\ub2e4. Switch Transformer \ub17c\ubb38\uc740 \uc774\ub7ec\ud55c \uc810\uc744 \uc9c0\uc801\ud558\uba70, sparse model: \ubaa8\ub378\uc758 \ubaa8\ub4e0 parameter \uac00 \ud55c \ud1a0\ud070\uc758 \ucd94\ub860\uc5d0 \ud544\uc694\ud558\uc9c0 \uc54a\uc740 \ubc29\uc2dd - \uc758 \ud6a8\uc6a9\uc744 \uac15\uc870\ud569\ub2c8\ub2e4."}),"\n",(0,t.jsxs)(n.p,{children:["SwitchTransforemer \ub17c\ubb38\uc740 ",(0,t.jsx)(n.strong,{children:"MOE \uad6c\uc870\uc758 \uc801\uc6a9\uacfc \ubd84\uc11d\uc744 \uad6c\uccb4\uc801\uc73c\ub85c pre-training, fine-tuning \uadf8\ub9ac\uace0 multi-task learning \uc73c\ub85c \ub098\ub204\uc5b4 \uc9c4\ud589"}),"\ud569\ub2c8\ub2e4. \ud604\ub300 LLM-MOE \uad6c\uc870 \ubd84\uc11d\uc5d0\uc11c pre-train, fine-tuning \uadf8\ub9ac\uace0 instruction-tuning \uc744 \ub098\ub204\uc5b4 \ubd84\uc11d\ud558\ub294 \uac83\uc744 \uc0dd\uac01\ud588\uc744 \ub54c \ud070 \uc758\ubbf8\uac00 \uc788\ub294 \ub17c\ubb38\uc774\ub77c\uace0 \uc0dd\uac01\ub429\ub2c8\ub2e4."]}),"\n",(0,t.jsxs)(n.p,{children:["\ub610\ud55c ",(0,t.jsx)(n.strong,{children:"Sparse Model \uc744 Dense Model\ub85c \uc131\uacf5\uc801\uc73c\ub85c distillation"}),"\ud558\uba70, \ud6a8\uc728\uc801\uc778 distillation \ubc29\uc548\uc744 \uc81c\uc2dc\ud569\ub2c8\ub2e4."]}),"\n",(0,t.jsx)(n.p,{children:"\uc704 \ub450\uac00\uc9c0\ub294 \uc0ac\uc2e4\uc0c1 \ud604\ub300 sparse-LLM \uac1c\ubc1c\uc5d0\uc11c \uac00\uc7a5 \uc911\uc694\ud558\uac8c \ud655\uc778\ud558\ub294 \ub450 \uac00\uc9c0 \uc791\uc5c5\uc785\ub2c8\ub2e4."}),"\n",(0,t.jsxs)(n.p,{children:["\ub9c8\uc9c0\ub9c9\uc73c\ub85c, Switch Transformer \ub294 Transformer \uc5d0\uc11c \uc804\ud1b5\uc801\uc73c\ub85c \uc801\uc6a9\ub418\ub358 FFN Expert Layer \ub97c \uc0ac\uc6a9\ud558\uc9c0 \uc54a\uace0, ",(0,t.jsx)(n.strong,{children:"Attention Expert Layer \ub97c \uc2e4\ud5d8"}),"\ud574\ubcf4\uae30\ub3c4 \ud569\ub2c8\ub2e4. \uc774\uc5d0 \ub300\ud55c \uacb0\uacfc\ub294 \ud6c4\uc220\ud558\uaca0\uc2b5\ub2c8\ub2e4."]}),"\n",(0,t.jsx)(n.h2,{id:"model-\uad6c\uc870",children:"Model \uad6c\uc870"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"alt text",src:s(6312).A+"",width:"1270",height:"908"})}),"\n",(0,t.jsx)(n.p,{children:"Switch Transformer \uc758 \uac1c\ub150\uc801\uc778 \uad6c\uc870\ub294 GShard \ub17c\ubb38\uacfc \ub3d9\uc77c\ud569\ub2c8\ub2e4. \uadf8\ub7ec\ub098 Switch Transformer \ub17c\ubb38\uc740 GShard\uc640 \ud06c\uac8c 3\uac00\uc9c0: 1) Attention Layer Expert \uc2e4\ud5d8, 2) Single Expert \uc801\uc6a9, 3) Load Balancing \uc744 \uc704\ud55c Loss \uad6c\uc870 \uac1c\uc120 - \uc810\uc5d0\uc11c \ucc28\ubcc4\ud654\ub429\ub2c8\ub2e4."}),"\n",(0,t.jsx)(n.h3,{id:"attention-layer-expert",children:"Attention Layer Expert"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"alt text",src:s(803).A+"",width:"1268",height:"970"})}),"\n",(0,t.jsxs)(n.p,{children:["\uc77c\ubc18\uc801\uc73c\ub85c Transformer MOE \uad6c\uc870\ub4e4\uc740 FFN Layer\uc5d0 MOE \ub97c \uc801\uc6a9\ud558\ub294 \uac83\uc744 \uae30\ubcf8\uc73c\ub85c \ud569\ub2c8\ub2e4. Switch Transformer \uc800\uc790\ub4e4\uc740 Self-Attention Layer\uc5d0 MOE\ub97c \uc801\uc6a9\ud558\ub294 \ubaa8\ub378 \uad6c\uc870\ub97c \ud14c\uc2a4\ud2b8\ud569\ub2c8\ub2e4. \ub17c\ubb38\uc5d0\uc11c\ub294 ",(0,t.jsxs)(n.span,{className:"katex",children:[(0,t.jsx)(n.span,{className:"katex-mathml",children:(0,t.jsx)(n.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,t.jsxs)(n.semantics,{children:[(0,t.jsx)(n.mrow,{children:(0,t.jsxs)(n.msub,{children:[(0,t.jsx)(n.mi,{children:"W"}),(0,t.jsxs)(n.mrow,{children:[(0,t.jsx)(n.mi,{children:"Q"}),(0,t.jsx)(n.mo,{separator:"true",children:","}),(0,t.jsx)(n.mi,{children:"K"}),(0,t.jsx)(n.mo,{separator:"true",children:","}),(0,t.jsx)(n.mi,{children:"V"})]})]})}),(0,t.jsx)(n.annotation,{encoding:"application/x-tex",children:"W_{Q, K, V}"})]})})}),(0,t.jsx)(n.span,{className:"katex-html","aria-hidden":"true",children:(0,t.jsxs)(n.span,{className:"base",children:[(0,t.jsx)(n.span,{className:"strut",style:{height:"0.9694em",verticalAlign:"-0.2861em"}}),(0,t.jsxs)(n.span,{className:"mord",children:[(0,t.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.13889em"},children:"W"}),(0,t.jsx)(n.span,{className:"msupsub",children:(0,t.jsxs)(n.span,{className:"vlist-t vlist-t2",children:[(0,t.jsxs)(n.span,{className:"vlist-r",children:[(0,t.jsx)(n.span,{className:"vlist",style:{height:"0.3283em"},children:(0,t.jsxs)(n.span,{style:{top:"-2.55em",marginLeft:"-0.1389em",marginRight:"0.05em"},children:[(0,t.jsx)(n.span,{className:"pstrut",style:{height:"2.7em"}}),(0,t.jsx)(n.span,{className:"sizing reset-size6 size3 mtight",children:(0,t.jsxs)(n.span,{className:"mord mtight",children:[(0,t.jsx)(n.span,{className:"mord mathnormal mtight",children:"Q"}),(0,t.jsx)(n.span,{className:"mpunct mtight",children:","}),(0,t.jsx)(n.span,{className:"mord mathnormal mtight",style:{marginRight:"0.07153em"},children:"K"}),(0,t.jsx)(n.span,{className:"mpunct mtight",children:","}),(0,t.jsx)(n.span,{className:"mord mathnormal mtight",style:{marginRight:"0.22222em"},children:"V"})]})})]})}),(0,t.jsx)(n.span,{className:"vlist-s",children:"\u200b"})]}),(0,t.jsx)(n.span,{className:"vlist-r",children:(0,t.jsx)(n.span,{className:"vlist",style:{height:"0.2861em"},children:(0,t.jsx)(n.span,{})})})]})})]})]})})]}),"\uc5d0 MOE \uad6c\uc870\ub97c \uc0ac\uc6a9\ud574\ubd05\ub2c8\ub2e4. \uc2e4\ud5d8 \uacb0\uacfc \ubaa8\ub378\uc758 \uc131\ub2a5\uc740 \uac1c\uc120\ub418\uc5c8\uc73c\ub098, ",(0,t.jsxs)(n.span,{className:"katex",children:[(0,t.jsx)(n.span,{className:"katex-mathml",children:(0,t.jsx)(n.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,t.jsxs)(n.semantics,{children:[(0,t.jsxs)(n.mrow,{children:[(0,t.jsx)(n.mi,{children:"f"}),(0,t.jsx)(n.mi,{children:"p"}),(0,t.jsx)(n.mn,{children:"16"})]}),(0,t.jsx)(n.annotation,{encoding:"application/x-tex",children:"fp16"})]})})}),(0,t.jsx)(n.span,{className:"katex-html","aria-hidden":"true",children:(0,t.jsxs)(n.span,{className:"base",children:[(0,t.jsx)(n.span,{className:"strut",style:{height:"0.8889em",verticalAlign:"-0.1944em"}}),(0,t.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.10764em"},children:"f"}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"p"}),(0,t.jsx)(n.span,{className:"mord",children:"16"})]})})]})," \uc0ac\uc6a9 \uc2dc \ubaa8\ub378\uc758 \ud559\uc2b5\uc774 \ubd88\uc548\uc815\ud558\uc5ec \ucd5c\uc885 \uacb0\uacfc\uc5d0\uc11c\ub294 \uc81c\uc678\ud588\ub2e4\uace0 \ud569\ub2c8\ub2e4."]}),"\n",(0,t.jsx)(n.h3,{id:"single-expert",children:"Single Expert"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://arxiv.org/pdf/1701.06538",children:"The Sparsely-gated mixture-of-experts layer"}),"[1] \ub17c\ubb38\uc5d0\uc11c\ub294 MOE \uad6c\uc870 \ud559\uc2b5\uc744 \uc704\ud574\uc11c\ub294 \ucd5c\uc18c 2\uac1c\uc758 experts \uac00 \ud544\uc218\ub77c\uace0 \uc8fc\uc7a5\ud569\ub2c8\ub2e4. \ud558\uc704 layer \uc5d0\uc11c\ub294 \ud070 k \uac12\uc774 \ud544\uc694\ud558\uace0, \uc0c1\uc704 layer \uc5d0\uc11c\ub294 \uc791\uc740 k \uac12\uc774 \ud544\uc694\ud558\ub2e4\ub294 \uc5f0\uad6c\ub3c4 \uc874\uc7ac\ud569\ub2c8\ub2e4."]}),"\n",(0,t.jsx)(n.p,{children:"Switch Transformer\ub294 top-1 expert\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. \uc800\uc790\ub4e4\uc740 \uc774 \ubc29\uc2dd\uc774 \ubaa8\ub378\uc758 \uc131\ub2a5\uc744 \uac70\uc758 \uc720\uc9c0\ud558\uba74\uc11c, \ubaa8\ub378\uc758 \uc804\uccb4\uc801\uc778 \uacc4\uc0b0\ub7c9\uc744 \ud06c\uac8c \uac10\uc18c\uc2dc\ud0a8\ub2e4\uace0 \ud569\ub2c8\ub2e4. top-1 forwarding \uc744 \uc0ac\uc6a9\ud558\ub294 MOE layer \ub97c Switch Layer \ub77c \ud569\ub2c8\ub2e4."}),"\n",(0,t.jsx)(n.h3,{id:"differentiable-load-balancing",children:"Differentiable Load Balancing"}),"\n",(0,t.jsxs)(n.p,{children:["Switch Transformer \ub17c\ubb38\ub3c4 expert capacity \uac1c\ub150\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4. \uadf8 \uc678\uc5d0\ub3c4, ",(0,t.jsx)(n.a,{href:"/docs/tasks/efficienttrain/MOE/gshard",children:"gshard"}),"\uc640 \uac19\uc774 load balancing loss \uc5ed\uc2dc \ud65c\uc6a9\ud569\ub2c8\ub2e4."]}),"\n",(0,t.jsx)(n.p,{children:"GShard \ub17c\ubb38\uc758 load balancing loss \ub294 \uc0d8\ud50c \uadf8\ub8f9 \ub2e8\uc704\ub85c, gating layer \uc758 output \uc744 \uc774\uc6a9\ud55c gating \uae30\ub313\uac12\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4."}),"\n",(0,t.jsx)(n.p,{children:"Switch Transformer \uc5d0\uc11c\ub294 expert \uac00 \ucc98\ub9ac\ud55c token \uc218\uc640 expert \ub85c \ucc98\ub9ac\ub420 \ud655\ub960\uc744 \uacf1\ud574\uc11c differentiable loss \ub97c \uad6c\ud604\ud569\ub2c8\ub2e4."}),"\n",(0,t.jsx)(n.h2,{id:"result",children:"Result"}),"\n",(0,t.jsx)(n.p,{children:"\uba3c\uc800 Switch Transformer\ub294 \ubaa8\ub378\uc774 \ucda9\ubd84\ud788 \ud559\uc2b5\ub418\uc9c0 \uc54a\ub294 \uac83\uc744 \ub9c9\uae30 \uc704\ud574 \ub300\uaddc\ubaa8 \ub370\uc774\ud130\ub97c \ud65c\uc6a9\ud569\ub2c8\ub2e4."}),"\n",(0,t.jsx)(n.h3,{id:"scaling-result",children:"Scaling Result"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"alt text",src:s(42).A+"",width:"1232",height:"974"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"\ubaa8\ub378\uc758 \ud06c\uae30\uac00 \uac19\uc544\ub3c4 expert \ub97c \ub298\ub9ac\uba74 \ud559\uc2b5\uc774 \ub354 \uc798\ub41c\ub2e4. (\uaebc\uc758 consistent \ud55c \uacb0\uacfc)"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"alt text",src:s(4709).A+"",width:"1280",height:"820"})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsx)(n.li,{children:"\ub300\uc751\ud558\ub294 \ud06c\uae30\uc758 dense model \uc5d0 \ube44\ud574 \ucd5c\ub300 7\ubc30\uc758 \uc18d\ub3c4 \uac1c\uc120\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"\ucc38\uace0\ub85c \ub300\uc751\ud558\ub294 \ud06c\uae30\uc758 dense model \uc740 Switch Transformer, \uc2e4\uc9c8\uc801\uc778 parameter \uc218\ub97c \uc774\uc6a9\ud574 \ube44\uad50\ud558\ub294 \uc218\uc2dd\uc744 \ub17c\ubb38\uc5d0\uc11c \uc18c\uac1c\ud558\uace0\uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,t.jsx)(n.h3,{id:"fine-tuning",children:"Fine-tuning"}),"\n",(0,t.jsx)(n.p,{children:"\uc774\ub807\uac8c \ud559\uc2b5\ud55c \ubaa8\ub378\uc744 \ub2e4\uc591\ud55c fine-tuning \ud574\ubcf8 \uacb0\uacfc Switch Transformer \ub294 \ub300\ubd80\ubd84\uc758 task\uc5d0\uc11c dense \ubaa8\ub378\ubcf4\ub2e4 \uc88b\uc740 \uc131\ub2a5\uc744 \ubcf4\uc600\uc2b5\ub2c8\ub2e4."}),"\n",(0,t.jsx)(n.h3,{id:"distillation",children:"Distillation"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"\uba3c\uc800 dense model \uc758 non-expert weight \ub97c MOE \ubaa8\ub378 weight \ub85c initialization \ud558\ub294 \uac83\uc740 \uc57d\uac04\uc758 \uac1c\uc120 \ud6a8\uacfc\ub97c \ubcf4\uc5ec\uc900\ub2e4\uace0 \ud569\ub2c8\ub2e4."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"75% \uc758 GT \ub77c\ubca8\uacfc 25% \uc758 teacher model (MOE model) \ub77c\ubca8\uc744 \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \ubaa8\ub378 \uc131\ub2a5\uc5d0 \ub3c4\uc6c0\uc774 \ub418\uc5c8\ub2e4."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"distillation \uc744 \ud1b5\ud574 82% \ubaa8\ub378 \uc555\ucd95\ud558\uba74\uc11c, 37% \uc758 quality gain \uc744 \uc5bb\uc744 \uc218 \uc788\uc5c8\ub2e4."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"3-1. quality gain \uc740 distillation \uc774\uc804 teach - student \ucc28\uc774\uc5d0 \ube44\ud574 distillation \uc774\ud6c4 \uc881\ud600\uc9c4 \ucc28\uc774\ub97c \uc758\ubbf8\ud55c\ub2e4."}),"\n",(0,t.jsxs)(n.ol,{start:"4",children:["\n",(0,t.jsx)(n.li,{children:"99% \ubaa8\ub378\uc744 \uc555\ucd95\ud558\ub354\ub77c\ub3c4 28% \uc758 quality gain \uc744 \uc5bb\uc744 \uc218 \uc788\uc5c8\ub2e4."}),"\n"]}),"\n",(0,t.jsx)(n.h1,{id:"ref",children:"Ref"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://arxiv.org/pdf/1701.06538",children:"The Sparsely-gated mixture-of-experts layer"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://arxiv.org/pdf/2101.03961",children:"Switch Transformer"})}),"\n"]})]})}function o(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>l});var i=s(6540);const t={},r=i.createContext(t);function a(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);